<%- include('../../partials/header') %> <%- include('../../partials/post-form')
%>
  

<main class="container col-md-10 py-2 mt-3">
  <div class="row justify-content-center mb-3">
    <% for (post of posts) { %>
      <div class="col-12 col-md-10 justify-content-center align-items-center mb-4 mt-2">
        <div class="row align-items-center mb-2">
          <div class="col-auto">
            <a href="/profiles/<%= post.profile._id %>" class="async d-block"> 
              <img id="profile-photo"
                src="<%= post.profilePhoto %>"
                alt="Profile Image"
                class="rounded-circle img-fluid"
                style="width: 50px; height: 50px;" // Make sure the width and height are the same
              />
            </a>
          </div>
          <div class="col">
            <a href="/profiles/<%= post.profile._id %>" class="async text-dark text-decoration-none"> 
              <p class="m-0"> <%= post.petName %></p>
            </a>
          </div>
        </div>
        <div class="light-background border rounded-3 d-flex flex-column align-items-center p-3">
          <p class="fw-bold text-dark mb-2"><%= post.postDescription %></p>
          <img src="<%= post.images[0].url %>" class="img-fluid rounded mb-2" />
        </div>
        
        <div class="d-flex justify-content-end mt-2">
          <form action="/posts/<%= post._id %>/likes" method="POST">
            <input type="hidden" name="likingUserprofileId" value="<%= post.likingUserprofileId %> ">
            <button type="submit" class="async btn btn-outline-secondary"><span class="like-count"><%= post.likes%> Likes</span>
            </button>
          </form>
          <button class="btn btn-outline-secondary" onclick="toggleComments('<%= post._id %>')">            
              <%= post.postComments.length %> Comments
          </button>
        </div>
        
        <!-- Comments Section (Initially Hidden) -->
        <div id="comments-section-<%= post._id %>" class="col-md-12 mb-3" style="display: none;">
          <% post.postComments.forEach(comment => { %>
            <div class="comment mb-2">
              <strong class="d-block"><%= comment.petName %></strong>
              <div>
                <%= comment.commentText %>
              </div>
            </div>
            
            <form
              action="/posts/comments/<%= post._id %>?_method=DELETE"
              method="POST"
              class="col-md-12 d-flex justify-content-end mt-3 ms-auto"
              >
              
              <!-- hidden input value added to comment.profileId -->
              <input type="hidden" name="currentProfile" value="<%= comment.profileId %>">
              
              <!-- <% if (currentProfile.toString() === comment.profileId) { %>
                <button type="submit" class="btn btn-outline-dark me-2 ml-auto " id="commentXButton" style="visibility: visible;">X</button>
              <% } else { %>
                <button id="commentXButton" style="visibility: hidden;">X</button>
              <% } %> -->
            </form>

          <% }); %>
        </div>
        <!-- comment.profileId -->


        <!-- Comment Form (Initially Hidden) -->
        <div id="comment-form-<%= post._id %>" class="col-md-12" style="display: none;">
          <form action="/posts/<%= post._id %>/comments" method="POST">
            <textarea class="form-control mb-2" name="commentText" placeholder="Write a comment..." rows="3"></textarea>
            <button type="submit" class="async btn btn-success">Submit Comment</button>
            
          </form>
        </div>
      </div>
    <% } %>

    <!-- <% for (post of posts) { %>
    <div class="col-md-2 d-flex align-items-center">
      <div class="profile-photo-main-feed mb-1">
        <div class="row">
          <div class="col-md-12 col-md-5 p-0">
            <img id="profile-photo"
            src="<%= post.profilePhoto %>"
            alt="Profile Image"
            class="rounded-circle img-fluid"
            style="width: 70px; height: auto;"
            />
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-9 d-flex align-items-center">
      <div class="pet-name">
          <div class="row">
            <div class="col-md-1 p-0">
              <h4><%= post.petName %></h4>
            </div>
          </div>
        </div>
      </div>
      
    
        <div class="row align-items-md-stretch mt-3" id="pet-post" style="color: black">
          <div class="col-md-12">
            <div class="pet-post mb-2">
              <div class="h-100 p-2 bg-body-tertiary border rounded-3">
                <p><%= post.postDescription %></p>
                <img src="<%= post.postPhotoLink %>">
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-12 mb-4">
          <button  class="col-md-2 like-btn text-center text-bg-dark rounded-3 " data-like-count="0"><span class="like-count">0 Likes</span></button>

            
          <button  class="col-md-3 comment-btn text-center text-bg-dark rounded-3" type="submit"  data-comment-count="0"><span class="comment-count">0 Comments</span></button>
          

        </div>
        <% } %> -->

</main>

<%- include('../../partials/side-feed', { profiles }) %>

<script>
  function toggleComments(postId) {
    const commentsSection = document.getElementById('comments-section-' + postId);
    const commentForm = document.getElementById('comment-form-' + postId);
    const isHidden = commentsSection.style.display === 'none';
    
    commentsSection.style.display = isHidden ? 'block' : 'none';
    commentForm.style.display = isHidden ? 'block' : 'none';
  }

  // function likePost(postId) {
  //   const likeBtnEl = document.getElementById(
  //     "like-btn-" + postId)
  //   likeBtnEl.addEventListener(click, ()=>{

  //   })
  //   ;
  // }
//   document.addEventListener('DOMContentLoaded', function () {
//     const likeButton = document.querySelector('.like-btn');
            
//     likeButton.addEventListener('click', function () {
//       let likeCount = parseInt(likeButton.dataset.likeCount) || 0;
//       likeCount++;
            
//       // Update the like count in the data attribute
//       likeButton.dataset.likeCount = likeCount;
            
//       // Update the like count in the UI
//       const likeCountElement = likeButton.querySelector('.like-count');
//       likeCountElement.textContent = `${likeCount} Likes`;
//     });
// });
</script>

<%- include('../../partials/loading') %>

<%- include('../../partials/footer') %>